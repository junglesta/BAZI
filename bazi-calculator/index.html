<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Ultimate Ba Zi Calculator • 終極八字計算器</title>
        <meta name="description" content="Accurate Four Pillars of Destiny calculator with dark mode, bilingual support, and solar term corrections">
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/htmx.org@1.9.12"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.7.3/lunar.min.js"></script>
        <script>
            tailwind.config = {
                darkMode: 'class'
            }
        </script>
        <style>
            .chinese-char {
                font-size: 2.5rem;
                line-height: 1;
            }
            * {
                transition: background-color 0.3s ease, border-color 0.3s ease;
            }
            .dark::-webkit-scrollbar {
                width: 8px;
                height: 8px;
            }
            .dark::-webkit-scrollbar-track {
                background: rgba(31, 41, 55, 0.5);
            }
            .dark::-webkit-scrollbar-thumb {
                background: rgba(75, 85, 99, 0.8);
                border-radius: 4px;
            }
            .dark::-webkit-scrollbar-thumb:hover {
                background: rgba(107, 114, 128, 0.9);
            }
            .gradient-light {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
            .gradient-dark {
                background: linear-gradient(135deg, #1e3a8a 0%, #6b21a8 100%);
            }
            .pillar-card {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .pillar-card:hover {
                transform: translateY(-4px);
            }
            .chinese-glow {
                text-shadow: 0 0 20px rgba(147, 51, 234, 0.3);
            }
            .dark .chinese-glow {
                text-shadow: 0 0 25px rgba(167, 139, 250, 0.5);
            }
            .htmx-indicator {
                display: none;
            }
            .htmx-request .htmx-indicator {
                display: inline-block;
            }
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
            .animate-spin {
                animation: spin 1s linear infinite;
            }
        </style>
    </head>
    <body class="bg-gradient-to-br from-slate-50 to-slate-100 dark:from-gray-900 dark:to-slate-900 text-slate-900 dark:text-slate-100 min-h-screen">
        <main class="max-w-4xl mx-auto p-6 space-y-6">
            <!-- Header with Dark Mode Toggle -->
            <header class="flex justify-between items-start">
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 dark:from-purple-400 dark:to-pink-400 bg-clip-text text-transparent">
                        Ultimate Ba Zi Calculator • 終極八字計算器
                    </h1>
                    <p class="text-sm text-slate-600 dark:text-slate-400 mt-2">
                        Accurate Four Pillars of Destiny (四柱命理) with solar term corrections
                    </p>
                    <div class="mt-2 flex items-center gap-2">
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">
                            ✅ Oct 9, 1967 issue FIXED
                        </span>
                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                            v7.0.0
                        </span>
                    </div>
                </div>
                <!-- Dark Mode Toggle -->
                <button
                    id="theme-toggle"
                    type="button"
                    class="p-2.5 rounded-xl bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors"
                    aria-label="Toggle dark mode"
                >
                    <!-- Sun Icon (Light Mode) -->
                    <svg class="w-5 h-5 hidden dark:block text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path>
                    </svg>
                    <!-- Moon Icon (Dark Mode) -->
                    <svg class="w-5 h-5 block dark:hidden text-slate-700" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                    </svg>
                </button>
            </header>

            <!-- FORM -->
            <form id="bazi-form" 
                  hx-get="/api/bazi/html" 
                  hx-trigger="submit" 
                  hx-target="#result"
                  hx-indicator="#loading"
                  class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg dark:shadow-2xl p-6 border border-slate-200 dark:border-slate-700">
                
                <div class="grid md:grid-cols-4 gap-4">
                    <label class="block">
                        <span class="text-xs text-slate-500 dark:text-slate-400">Year • 年</span>
                        <input
                            id="year"
                            name="year"
                            type="number"
                            min="1900"
                            max="2100"
                            class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 p-2 focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-transparent"
                            required
                        />
                    </label>
                    <label class="block">
                        <span class="text-xs text-slate-500 dark:text-slate-400">Month • 月</span>
                        <input
                            id="month"
                            name="month"
                            type="number"
                            min="1"
                            max="12"
                            class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 p-2 focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-transparent"
                            required
                        />
                    </label>
                    <label class="block">
                        <span class="text-xs text-slate-500 dark:text-slate-400">Day • 日</span>
                        <input
                            id="day"
                            name="day"
                            type="number"
                            min="1"
                            max="31"
                            class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 p-2 focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-transparent"
                            required
                        />
                    </label>
                    <label class="block">
                        <span class="text-xs text-slate-500 dark:text-slate-400">Hour • 時 (0–23)</span>
                        <input
                            id="hour"
                            name="hour"
                            type="number"
                            min="0"
                            max="23"
                            class="mt-1 w-full rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 p-2 focus:ring-2 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-transparent"
                            required
                        />
                    </label>
                </div>

                <div class="mt-6 flex flex-wrap gap-3 items-center">
                    <button
                        type="submit"
                        class="px-5 py-2.5 rounded-xl gradient-light dark:gradient-dark text-white font-medium hover:shadow-lg transform hover:scale-105 transition-all"
                    >
                        Calculate Ba Zi • 計算八字
                        <span id="loading" class="htmx-indicator ml-2">
                            <svg class="animate-spin h-4 w-4 inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </span>
                    </button>
                    <button
                        type="button"
                        id="btn-now"
                        class="px-5 py-2.5 rounded-xl bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 font-medium transition-all"
                    >
                        Use Current Time • 現在時間
                    </button>
                    <button
                        type="button"
                        id="btn-test"
                        hx-get="/api/test/html"
                        hx-target="#test-results"
                        class="px-5 py-2.5 rounded-xl bg-green-600 hover:bg-green-700 text-white font-medium transition-all"
                    >
                        Run Tests • 測試
                    </button>
                </div>
            </form>

            <!-- RESULT AREA -->
            <section id="result" class="min-h-24"></section>
            
            <!-- TEST RESULTS AREA -->
            <section id="test-results"></section>

            <!-- Legend/Help Section -->
            <details class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg dark:shadow-2xl border border-slate-200 dark:border-slate-700 p-6">
                <summary class="cursor-pointer font-semibold text-sm text-slate-900 dark:text-slate-100">
                    📖 Understanding Your Ba Zi Chart • 了解您的八字
                </summary>
                <div class="mt-4 space-y-4 text-sm">
                    <div>
                        <h4 class="font-semibold text-slate-900 dark:text-slate-100">The Four Pillars (四柱):</h4>
                        <div class="grid md:grid-cols-2 gap-3 mt-2">
                            <div class="p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                                <span class="font-semibold text-purple-600 dark:text-purple-400">Year Pillar (年柱)</span>
                                <p class="text-xs mt-1 text-slate-600 dark:text-slate-400">Represents ancestry, grandparents, and social environment</p>
                            </div>
                            <div class="p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                                <span class="font-semibold text-purple-600 dark:text-purple-400">Month Pillar (月柱)</span>
                                <p class="text-xs mt-1 text-slate-600 dark:text-slate-400">Represents career, parents, and growth environment</p>
                            </div>
                            <div class="p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                                <span class="font-semibold text-purple-600 dark:text-purple-400">Day Pillar (日柱)</span>
                                <p class="text-xs mt-1 text-slate-600 dark:text-slate-400">Represents self, spouse, and adult life</p>
                            </div>
                            <div class="p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg">
                                <span class="font-semibold text-purple-600 dark:text-purple-400">Hour Pillar (時柱)</span>
                                <p class="text-xs mt-1 text-slate-600 dark:text-slate-400">Represents children, students, and later life</p>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-slate-900 dark:text-slate-100">The Five Elements (五行):</h4>
                        <div class="flex flex-wrap gap-2 mt-2">
                            <span class="px-3 py-1 bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded-full text-xs">Wood 木</span>
                            <span class="px-3 py-1 bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 rounded-full text-xs">Fire 火</span>
                            <span class="px-3 py-1 bg-yellow-100 dark:bg-yellow-900/50 text-yellow-700 dark:text-yellow-300 rounded-full text-xs">Earth 土</span>
                            <span class="px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-xs">Metal 金</span>
                            <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 rounded-full text-xs">Water 水</span>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-slate-900 dark:text-slate-100">The 12 Zodiac Animals (十二生肖):</h4>
                        <div class="grid grid-cols-3 md:grid-cols-4 gap-2 mt-2 text-slate-700 dark:text-slate-300">
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">子</span>
                                <div class="text-xs">Rat 🐀</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">丑</span>
                                <div class="text-xs">Ox 🐂</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">寅</span>
                                <div class="text-xs">Tiger 🐅</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">卯</span>
                                <div class="text-xs">Rabbit 🐇</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">辰</span>
                                <div class="text-xs">Dragon 🐉</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">巳</span>
                                <div class="text-xs">Snake 🐍</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">午</span>
                                <div class="text-xs">Horse 🐎</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">未</span>
                                <div class="text-xs">Goat 🐐</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">申</span>
                                <div class="text-xs">Monkey 🐒</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">酉</span>
                                <div class="text-xs">Rooster 🐓</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">戌</span>
                                <div class="text-xs">Dog 🐕</div>
                            </div>
                            <div class="p-2 rounded-lg bg-slate-50 dark:bg-slate-700/50 text-center">
                                <span class="text-lg font-bold text-purple-600 dark:text-purple-400">亥</span>
                                <div class="text-xs">Pig 🐖</div>
                            </div>
                        </div>
                    </div>
                </div>
            </details>

            <footer class="text-xs text-slate-600 dark:text-slate-400 text-center">
                <p>Powered by lunar-javascript with solar term corrections</p>
                <p class="mt-1">Created with ❤️ • Version 7.0.0</p>
            </footer>
        </main>

        <script>
            // Dark mode initialization and toggle
            (function() {
                const savedTheme = localStorage.getItem('theme') || 'auto';
                
                function applyTheme(theme) {
                    if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                }
                
                applyTheme(savedTheme);
                
                document.addEventListener('DOMContentLoaded', function() {
                    const themeToggle = document.getElementById('theme-toggle');
                    
                    themeToggle.addEventListener('click', function() {
                        const isDark = document.documentElement.classList.contains('dark');
                        const newTheme = isDark ? 'light' : 'dark';
                        
                        document.documentElement.classList.toggle('dark');
                        localStorage.setItem('theme', newTheme);
                    });
                });
                
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                    if (localStorage.getItem('theme') === 'auto') {
                        applyTheme('auto');
                    }
                });
            })();

            // Use Current Time button
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('btn-now').addEventListener('click', function() {
                    const now = new Date();
                    document.getElementById('year').value = now.getFullYear();
                    document.getElementById('month').value = now.getMonth() + 1;
                    document.getElementById('day').value = now.getDate();
                    document.getElementById('hour').value = now.getHours();
                });
                
                // Set default to current time
                document.getElementById('btn-now').click();
            });
        </script>
    </body>
</html>
