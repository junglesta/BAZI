<!doctype html>
<html lang="en">
    <!--

          _                   _           _
         | |_   _ _ __   __ _| | ___  ___| |_ __ _ _ __
      _  | | | | | '_ \ / _` | |/ _ \/ __| __/ _` | '__|
     | |_| | |_| | | | | (_| | |  __/\__ \ || (_| | |
      \___/ \__,_|_| |_|\__, |_|\___||___/\__\__,_|_|
                        |___/

     site     : https://junglestar.org
     email    : info@junglestar.org
     twitter	: @rokmatwit


    -->

    <head>
        <meta name="version" content="101" />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- SEO and Sharing Meta Tags -->
        <meta
            name="description"
            content="Calculate your BA ZI (Four Pillars of Destiny) with astronomical precision. Based on real solar positions and the 24 Solar Terms, not calendar approximations."
        />
        <meta
            name="keywords"
            content="Ba Zi, Four Pillars, 八字, Chinese astrology metaphors, astronomical precision, solar terms, destiny calculator, Ganzhi calendar"
        />
        <meta
            name="author"
            content="Toybreaker with ClaudeOpus4.1, Powered by JUNGLESTAR Yo!"
        />

        <!-- Open Graph Meta Tags -->
        <meta
            property="og:title"
            content="Ba Zi 八字 - Astronomically Accurate Four Pillars Calculator"
        />
        <meta
            property="og:description"
            content="Calculate your Four Pillars of Destiny based on precise astronomical data. Mathematics meets ancient metaphors."
        />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://bazi.junglestar.org" />
        <meta
            property="og:image"
            content="https://bazi.junglestar.org/bazi-preview.png"
        />

        <!-- Twitter Card Meta Tags -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="Ba Zi 八字 Calculator" />
        <meta
            name="twitter:description"
            content="Your destiny calculated with astronomical precision. Based on true solar positions, not calendar approximations."
        />
        <meta
            name="twitter:image"
            content="https://bazi.junglestar.org/bazi-preview.png"
        />

        <link rel="canonical" href="https://bazi.junglestar.org" />

        <title>
            Ba Zi 八字 - Astronomically Accurate Pillars Calculator | JUNGLESTAR
        </title>
        <style>
            :root {
                /* Primary Colors in OKLCH */
                --color-primary: oklch(
                    0.87 0.28 142
                ); /* chartreuse green #7fff00 */
                --color-primary-light: oklch(
                    0.89 0.25 142
                ); /* light green #adff2f */
                --color-secondary: oklch(0.69 0.2 142); /* lime green #32cd32 */

                /* Background Colors in OKLCH */
                --bg-dark: oklch(0.15 0.02 142); /* dark green-black */
                --bg-mid: oklch(0.25 0.05 142); /* mid green-black */
                --bg-light: oklch(0.18 0.03 142); /* light green-black */
                --bg-surface: oklch(1 0 0 / 0.05); /* white with opacity */
                --bg-surface-hover: oklch(
                    0 0 0 / 0.25
                ); /* white with opacity */

                /* Text Colors in OKLCH */
                --text-primary: oklch(1 0 0); /* white */
                --text-secondary: oklch(0.72 0 0); /* light gray */
                --text-muted: oklch(0.6 0 0); /* muted gray */

                /* Element Colors in OKLCH */
                --element-wood: oklch(0.69 0.2 142); /* green */
                --element-fire: oklch(0.64 0.2 41); /* red-orange */
                --element-earth: oklch(0.7 0.15 85); /* golden */
                --element-metal: oklch(0.82 0 0); /* silver */
                --element-water: oklch(0.6 0.18 237); /* blue */

                /* Element Backgrounds in OKLCH with opacity */
                --element-bg-wood: oklch(0.69 0.2 142 / 0.3);
                --element-bg-fire: oklch(0.64 0.2 41 / 0.3);
                --element-bg-earth: oklch(0.7 0.15 85 / 0.3);
                --element-bg-metal: oklch(0.82 0 0 / 0.3);
                --element-bg-water: oklch(0.6 0.18 237 / 0.3);

                /* Spacing */
                --spacing-xs: 0.25svh;
                --spacing-sm: 0.5svh;
                --spacing-md: 0.75svh;
                --spacing-base: 1svh;
                --spacing-lg: 1.5svh;
                --spacing-xl: 2svh;
                --spacing-2xl: 3svh;
                --spacing-3xl: 5svh;
                --spacing-section: 8dvw;

                /* Border Radius */
                --radius-xs: 0.175svh;
                --radius-sm: 0.5svh;
                --radius-md: 0.75svh;
                --radius-base: 1svh;
                --radius-lg: 1.5svh;

                /* Typography */
                --font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    "Helvetica Neue", Arial, sans-serif;
                --font-size-xs: 0.85rem;
                --font-size-sm: 0.9rem;
                --font-size-base: 1rem;
                --font-size-md: 1.1rem;
                --font-size-lg: 1.2rem;
                --font-size-xl: 1.3rem;
                --font-size-2xl: 1.95rem;
                --font-size-3xl: 3rem;

                /* Transitions */
                --transition-fast: 0.2s ease;
                --transition-base: 0.3s ease;

                /* Borders in OKLCH */
                --border-subtle: 1px solid oklch(1 0 0 / 0.1);
                --border-visible: 1px solid oklch(1 0 0 / 0.2);
                --border-primary: 1px solid var(--color-primary);
                --border-green: 1px solid oklch(0.87 0.28 142 / 0.3);

                /* Effects */
                --blur-amount: 0.75svh;
                --shadow-glow: 0 0 0.65svh;
            }

            /* Reset & Base */
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            html {
                background-color: #000;
            }

            body {
                font-family: var(--font-family);
                background: linear-gradient(
                    135deg,
                    var(--bg-dark) 0%,
                    var(--bg-mid) 50%,
                    var(--bg-light) 100%
                );
                min-height: 100vh;
                color: var(--text-primary);
                padding: var(--spacing-base);
            }

            /* Container & Layout */
            .container {
                max-width: 1200px;
                margin: 0 auto;
            }

            /* Header */
            header {
                text-align: center;
                margin-bottom: var(--spacing-base);
                padding: var(--spacing-base);
                border-radius: var(--radius-base);
                backdrop-filter: blur(var(--blur-amount));
            }

            h1 {
                font-size: var(--font-size-3xl);
                margin-bottom: var(--spacing-sm);
                background: linear-gradient(
                    45deg,
                    var(--color-primary),
                    var(--color-primary-light)
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                font-weight: 300;
                letter-spacing: 3px;
            }

            /* Typography */
            h1,
            h2,
            h3 {
                font-weight: 300;
            }

            h4,
            h5,
            h6 {
                font-weight: 500;
            }

            h2.section-title {
                margin-bottom: var(--spacing-lg);
                font-size: var(--font-size-2xl);
            }

            h3 {
                margin-bottom: var(--spacing-lg);
            }

            /* Common Classes */
            .center {
                text-align: center;
            }

            .spread_left_right {
                display: flex;
                justify-content: space-between;
            }

            /* Links */
            .ext_link {
                color: var(--color-primary);
            }

            /* Badges */
            .validation-badge {
                display: inline-block;
                border-color: var(--color-primary);
                color: var(--color-primary);
                padding: var(--spacing-xs) var(--spacing-base);
                border-radius: var(--radius-base);
                font-size: var(--font-size-sm);
                margin-top: var(--spacing-base);
            }

            /* Sections */
            .section-card {
                backdrop-filter: blur(var(--blur-amount));
                /* background: var(--bg-surface-hover); */
                border-radius: var(--radius-md);
                padding-block: var(--spacing-lg);
                padding-inline: var(--spacing-lg);
                margin-block: var(--spacing-2xl);
                margin-inline: var(--spacing-lg);

                padding-top: var(--spacing-sm);
                margin-top: var(--spacing-sm);
            }

            /* Forms */
            .input-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: var(--spacing-base);
                margin-bottom: var(--spacing-base);
            }

            .input-group {
                display: flex;
                flex-direction: column;
            }

            label {
                margin-bottom: var(--spacing-xs);
                color: var(--color-primary-light);
                font-size: var(--font-size-sm);
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            input,
            select {
                padding: var(--spacing-sm);
                border: var(--border-visible);
                background: var(--bg-surface);
                color: var(--text-primary);
                border-radius: var(--radius-xs);
                font-size: var(--font-size-lg);
            }

            select {
                padding: var(--spacing-md);
                border-radius: var(--radius-sm);
            }

            /* Buttons */
            button {
                background: linear-gradient(
                    45deg,
                    var(--color-primary),
                    var(--color-secondary)
                );
                color: var(--bg-dark);
                border: none;
                padding: var(--spacing-md) var(--spacing-lg);
                border-radius: var(--radius-base);
                font-size: var(--font-size-md);
                font-weight: bold;
                cursor: pointer;
                transition: transform var(--transition-base);
                margin-top: var(--spacing-sm);
                margin-right: var(--spacing-sm);
            }

            button.stroke {
                background: none;
                color: var(--color-primary);
                border: 2px var(--color-primary) solid;
            }

            button:hover {
                transform: translateY(-2px);
            }

            /* URL Display */
            .url-display {
                margin-block: var(--spacing-lg);
                /* padding: var(--spacing-md); */
                background: var(--bg-surface);
                border-radius: var(--radius-md);
                font-size: var(--font-size-xs);
                color: var(--text-primary);
                display: none;
                align-items: center;
                word-break: break-all;
                border: var(--border-subtle);
            }

            .button_copy {
                cursor: pointer;
                display: block;
                /* font-size: var(--font-size-lg); */
                vertical-align: middle;
                transition: transform var(--transition-fast);
                margin-right: var(--spacing-md);
            }

            .url-text {
                vertical-align: middle;
            }

            /* Date Display */
            .calculated-date-info {
                text-align: center;
                margin-block: var(--spacing-md);
            }

            .date-display {
                font-size: var(--font-size-md) !important;
                color: var(--color-primary);
                letter-spacing: 0.5px;
            }

            /* Astronomical Data */
            .astronomical-data {
                background: oklch(0.69 0.2 142 / 0.1);
                border: var(--border-green);
                border-radius: var(--radius-base);
                padding: var(--spacing-base);
                margin-bottom: var(--spacing-xl);
            }

            .astronomical-data h3 {
                color: var(--color-primary);
            }

            .data-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: var(--spacing-base);
                margin-top: var(--spacing-base);
            }

            .data_card {
                display: flex;
                align-items: start;
                justify-content: space-between;
                background: var(--bg-surface);
                padding: var(--spacing-base);
                border-radius: var(--radius-md);
                border: var(--border-subtle);
            }

            .data_label {
                /*color: var(--text-muted);*/
                font-size: var(--font-size-md);
                margin-bottom: var(--spacing-md);
            }

            .data-value {
                font-size: var(--font-size-xl);
                font-weight: bold;
                color: var(--color-primary);
            }

            .utc-time {
                font-size: var(--font-size-base);
            }

            /* Pillars */
            .pillars-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: var(--spacing-sm);
                margin-top: var(--spacing-lg);
                margin-bottom: var(--spacing-lg);
            }

            .pillar {
                background: var(--bg-surface-hover);
                border-radius: var(--radius-sm);
                padding: var(--spacing-md);
                text-align: center;
                border: 2px solid oklch(0.87 0.28 142 / 0.3);
                position: relative;
            }

            .pillar-title {
                font-size: var(--font-size-xl);
                color: var(--color-primary-light);
                margin-bottom: var(--spacing-md);
                font-weight: 300;
                opacity: 0.335;
            }

            .stem-branch {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: var(--spacing-md);
                margin: var(--spacing-md) 0;
            }

            .chinese-char {
                font-size: var(--font-size-2xl);
                font-weight: bold;
            }

            .pinyin {
                color: var(--text-secondary);
                font-size: var(--font-size-lg);
                margin-top: 3px;
            }

            /* Elements */
            .element {
                display: inline-block;
                padding: 5px var(--spacing-md);
                border-radius: var(--radius-lg);
                font-size: var(--font-size-md);
                margin-top: var(--spacing-md);
                margin-bottom: var(--spacing-xl);
                font-weight: bold;
            }

            .element-wood {
                background: var(--element-bg-wood);
                color: var(--element-wood);
            }

            .element-fire {
                background: var(--element-bg-fire);
                color: var(--element-fire);
            }

            .element-earth {
                background: var(--element-bg-earth);
                color: var(--element-earth);
            }

            .element-metal {
                background: var(--element-bg-metal);
                color: var(--element-metal);
            }

            .element-water {
                background: var(--element-bg-water);
                color: var(--element-water);
            }

            /* Animal Emojis */
            .animal-emoji {
                font-size: 6.5rem;
                margin: var(--spacing-md) 0;
            }

            .animal-emoji-wood {
                filter: url(#greenify)
                    drop-shadow(var(--shadow-glow) oklch(0.87 0.28 142 / 0.5));
            }

            .animal-emoji-fire {
                filter: url(#redify)
                    drop-shadow(var(--shadow-glow) oklch(0.64 0.2 41 / 0.5));
            }

            .animal-emoji-earth {
                filter: url(#earthify)
                    drop-shadow(var(--shadow-glow) oklch(0.7 0.15 85 / 0.5));
            }

            .animal-emoji-metal {
                filter: url(#metalify)
                    drop-shadow(var(--shadow-glow) oklch(0.82 0 0 / 0.5));
            }

            .animal-emoji-water {
                filter: url(#blueify)
                    drop-shadow(var(--shadow-glow) oklch(0.6 0.18 237 / 0.5));
            }

            .animal-info {
                font-size: 2.4rem;
                margin: var(--spacing-md) 0;
                font-weight: 500;
            }

            .animal-yy {
                font-size: 1.55rem;
                margin: var(--spacing-xs) 0;
                font-weight: 500;
            }

            /* Solar Term Info */
            .solar-term-info {
                background: oklch(0.65 0.15 142 / 0.1);
                border: 1px solid oklch(0.65 0.15 142 / 0.3);
                border-radius: var(--radius-md);
                padding: var(--spacing-lg);
                margin-top: var(--spacing-lg);
            }

            .solar-term-info h3 {
                color: var(--color-secondary);
            }

            .term-progress {
                width: 100%;
                height: var(--spacing-lg);
                background: oklch(1 0 0 / 0.1);
                border-radius: var(--radius-md);
                overflow: hidden;
                margin-top: var(--spacing-md);
            }

            .term-progress-bar {
                height: 100%;
                background: linear-gradient(
                    90deg,
                    var(--color-primary),
                    oklch(0.59 0.17 142)
                );
                transition: width var(--transition-base);
            }

            /* Test Cases */
            .test-cases {
                background: oklch(0.69 0.2 142 / 0.05);
                border: 1px solid oklch(0.87 0.28 142 / 0.2);
                border-radius: var(--radius-md);
                padding: var(--spacing-md);
                margin-top: var(--spacing-base);
            }

            .test-cases h3 {
                color: var(--color-primary);
                margin-bottom: var(--spacing-md);
            }

            .test-button {
                background: oklch(0.87 0.28 142 / 0.2);
                color: var(--color-primary);
                border: var(--border-primary);
                padding: 0.65svh var(--spacing-md);
                margin: 5px;
                font-size: var(--font-size-sm);
            }

            .test-button:hover {
                background: oklch(0.87 0.28 142 / 0.3);
            }

            /* Footer */
            .footwrap {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
                padding-block: var(--spacing-3xl);
                padding-inline: var(--spacing-base);
            }

            .share {
                padding-top: var(--spacing-3xl);
            }

            .qr {
                display: block;
                min-width: 200px;
                width: var(--spacing-base);
                max-width: 400px;
                height: auto;
            }

            .donation {
                border-color: var(--color-primary);
                margin-block: var(--spacing-base);
                padding: var(--spacing-base);
                text-align: right;
                border-top: var(--border-primary);
                line-height: 2;
            }

            fieldset {
                border: 0 none;
            }

            .pad_top {
                padding-top: 2svh;
            }
            .pad_bottom {
                padding-bottom: 2svh;
            }

            .flex_rows {
                display: flex;
            }

            /* Media Queries */
            @media (max-width: 760px) {
                :root {
                    --font-size-3xl: 3.3rem;
                    --font-size-2xl: 1.85rem;
                }

                .pillars-container {
                    grid-template-columns: repeat(2, 1fr);
                    gap: var(--spacing-md);
                }

                .pillar {
                    padding: var(--spacing-md);
                }

                .chinese-char {
                    font-size: var(--spacing-md);
                }

                .animal-emoji {
                    font-size: 2.5rem;
                }

                .animal-info {
                    font-size: 1.8rem;
                }

                .element {
                    font-size: var(--font-size-sm);
                    padding: 3px var(--spacing-md);
                }

                button {
                    width: 100%;
                    margin-left: 0 !important;
                    /*margin-top: var(--spacing-md) !important;*/
                }
            }

            @media (max-width: 480px) {
                :root {
                    --font-size-2xl: 1.75rem;
                }

                .pillars-container {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 0.65svh;
                }

                .pillar {
                    padding: 0.85svh 0.65svh;
                }

                .pillar-title {
                    font-size: var(--font-size-xl);
                }

                .chinese-char {
                    font-size: 0.65rem;
                }

                .animal-emoji {
                    font-size: 5rem;
                }

                .pinyin {
                    font-size: 0.35rem;
                }

                .animal-info {
                    font-size: 1.4rem;
                }

                button {
                    width: 100%;
                    margin-left: 0 !important;
                    margin-top: var(--spacing-md) !important;
                }

                .url-display {
                    font-size: var(--spacing-md) !important;
                    padding-left: var(--spacing-md);
                }
            }

            .Yin {
                color: oklch(0.5338 0.2537 289.16 / 0.75);
                /*color: blueviolet;*/
            }
            .Yang {
                color: oklch(0.7516 0.1469 83.99 / 0.75);
                /*color: goldenrod;*/
            }

            .left {
                width: 100%;
                text-align: left;
            }
            .uppercase {
                text-transform: uppercase;
            }

            .vert {
                position: absolute;
                z-index: 3;
                right: 0.25rem;
                top: 0.75rem;
                transform: rotate(180deg);
                transform-origin: top top;
                writing-mode: vertical-rl;
                font-weight: 300;
            }

            .relative {
                position: relative;
            }

            /*Screen reader only content */

            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            /* Keyboard Shortcuts Section */
            .shortcuts-section {
                background: oklch(0.87 0.28 142 / 0.05);
                border: 1px solid oklch(0.87 0.28 142 / 0.3);
            }

            .shortcuts-title {
                color: var(--color-primary);
                margin-bottom: var(--spacing-lg);
            }

            .kbd {
                white-space: nowrap;
                background: var(--bg-mid);
                color: var(--color-primary);
                padding: 3px 8px;
                border-radius: 3px;
                font-family: monospace;
                border: 1px solid var(--color-primary);
                display: inline-block;
                font-size: var(--font-size-base);
            }
        </style>
    </head>
    <body>
        <!-- SVG Filters for Element-Colored Emojis -->
        <svg width="0" height="0" style="position: absolute">
            <defs>
                <!-- Wood Element Filter (Green) -->
                <filter id="greenify">
                    <feColorMatrix type="saturate" values="0" />
                    <feColorMatrix
                        type="matrix"
                        values="
                    0.3  0.3  0.3  0  0
                    0.8  0.8  0.8  0  0.2
                    0.3  0.3  0.3  0  0
                    0    0    0    1  0"
                    />
                </filter>

                <!-- Fire Element Filter (Red/Orange) -->
                <filter id="redify">
                    <feColorMatrix type="saturate" values="0" />
                    <feColorMatrix
                        type="matrix"
                        values="
                    1    1    1    0  0.2
                    0.3  0.3  0.3  0  0
                    0.1  0.1  0.1  0  0
                    0    0    0    1  0"
                    />
                </filter>

                <!-- Earth Element Filter (Golden Brown) -->
                <filter id="earthify">
                    <feColorMatrix type="saturate" values="0" />
                    <feColorMatrix
                        type="matrix"
                        values="
                    0.8  0.8  0.8  0  0.3
                    0.6  0.6  0.6  0  0.2
                    0.2  0.2  0.2  0  0
                    0    0    0    1  0"
                    />
                </filter>

                <!-- Metal Element Filter (Silver/White) -->
                <filter id="metalify">
                    <feColorMatrix type="saturate" values="0" />
                    <feColorMatrix
                        type="matrix"
                        values="
                    0.7  0.7  0.7  0  0.2
                    0.7  0.7  0.7  0  0.2
                    0.8  0.8  0.8  0  0.25
                    0    0    0    1  0"
                    />
                </filter>

                <!-- Water Element Filter (Deep Blue) -->
                <filter id="blueify">
                    <feColorMatrix type="saturate" values="0" />
                    <feColorMatrix
                        type="matrix"
                        values="
                    0.1  0.1  0.1  0  0
                    0.3  0.3  0.3  0  0.1
                    0.9  0.9  0.9  0  0.3
                    0    0    0    1  0"
                    />
                </filter>
            </defs>
        </svg>

        <div class="container">
            <header>
                <h1 class="spread_left_right">
                    <span>Ba Zi</span>
                    <span lang="zh">八字</span>
                </h1>
                <p class="validation-badge" role="doc-subtitle">
                    ✓ Mathematics meets ancient metaphors
                </p>
            </header>

            <main>
                <section aria-labelledby="results-title" class="relative">
                    <!--<h2
                        id="results-title"
                        class="section-title uppercase center"
                    >
                        NOW, HERE
                    </h2>-->
                    <div class="section-card">
                        <output
                            class="calculated-date-info"
                            id="calculatedDateInfo"
                            style="display: none"
                            aria-live="polite"
                        >
                            <span>Ba Zi for </span
                            ><time class="date-display" id="dateDisplay">
                                <!-- Date info will be inserted here -->
                            </time>
                        </output>

                        <!-- Pillars Container -->
                        <div
                            class="pillars-container"
                            id="pillarsContainer"
                            role="region"
                            aria-label="Four Pillars of Destiny"
                        ></div>
                    </div>
                </section>

                <section aria-labelledby="input-title" class="relative">
                    <h2 id="input-title" class="section-title uppercase center">
                        Enter Birth data
                    </h2>
                    <form
                        class="section-card"
                        onsubmit="event.preventDefault(); calculateBaZi();"
                    >
                        <fieldset class="input-grid">
                            <legend class="sr-only">Birth date and time</legend>
                            <div class="input-group">
                                <label for="year">Year</label>
                                <input
                                    type="number"
                                    id="year"
                                    min="1900"
                                    max="2030"
                                    value="1967"
                                    required
                                    aria-required="true"
                                />
                            </div>
                            <div class="input-group">
                                <label for="month">Month</label>
                                <input
                                    type="number"
                                    id="month"
                                    min="1"
                                    max="12"
                                    value="10"
                                    required
                                    aria-required="true"
                                />
                            </div>
                            <div class="input-group">
                                <label for="day">Day</label>
                                <input
                                    type="number"
                                    id="day"
                                    min="1"
                                    max="31"
                                    value="9"
                                    required
                                    aria-required="true"
                                />
                            </div>
                            <div class="input-group">
                                <label for="hour">Hour (24h)</label>
                                <input
                                    type="number"
                                    id="hour"
                                    min="0"
                                    max="23"
                                    value="0"
                                    required
                                    aria-required="true"
                                />
                            </div>
                            <div class="input-group">
                                <label for="minute">Minute</label>
                                <input
                                    type="number"
                                    id="minute"
                                    min="0"
                                    max="59"
                                    value="0"
                                    required
                                    aria-required="true"
                                />
                            </div>
                            <div class="input-group">
                                <label for="timezone">Timezone</label>
                                <select
                                    id="timezone"
                                    required
                                    aria-required="true"
                                >
                                    <option value="0">UTC / GMT</option>
                                    <option value="-12">
                                        Baker Island (UTC-12)
                                    </option>
                                    <option value="-11">Samoa (UTC-11)</option>
                                    <option value="-10">Hawaii (UTC-10)</option>
                                    <option value="-9">Alaska (UTC-9)</option>
                                    <option value="-8">
                                        Los Angeles (UTC-8)
                                    </option>
                                    <option value="-7">Denver (UTC-7)</option>
                                    <option value="-6">Chicago (UTC-6)</option>
                                    <option value="-5">New York (UTC-5)</option>
                                    <option value="-4">Halifax (UTC-4)</option>
                                    <option value="-3">
                                        São Paulo (UTC-3)
                                    </option>
                                    <option value="-2">
                                        Mid-Atlantic (UTC-2)
                                    </option>
                                    <option value="-1">Azores (UTC-1)</option>
                                    <option value="1">
                                        Berlin Winter (CEST UTC+1)
                                    </option>
                                    <option value="2">
                                        Berlin Summer (CEST UTC+2)
                                    </option>
                                    <option value="3">Moscow (UTC+3)</option>
                                    <option value="4">Dubai (UTC+4)</option>
                                    <option value="5">Karachi (UTC+5)</option>
                                    <option value="5.5">Delhi (UTC+5.5)</option>
                                    <option value="6">Dhaka (UTC+6)</option>
                                    <option value="7">Bangkok (UTC+7)</option>
                                    <option value="8">
                                        Beijing / Shanghai (UTC+8)
                                    </option>
                                    <option value="9">Tokyo (UTC+9)</option>
                                    <option value="10">Sydney (UTC+10)</option>
                                    <option value="11">Noumea (UTC+11)</option>
                                    <option value="12">
                                        Auckland (UTC+12)
                                    </option>
                                </select>
                            </div>
                        </fieldset>

                        <button type="submit" id="calculateBtn">
                            CALCULATE
                        </button>
                        <button
                            type="button"
                            id="resetBtn"
                            onclick="testCurrentTime()"
                            class="stroke"
                        >
                            RESET TO NOW
                        </button>
                        <button
                            type="button"
                            id="clearBtn"
                            onclick="clearSessionAndReload()"
                            class="stroke"
                        >
                            CLEAR SESSION
                        </button>

                        <div class="flex_rows">
                            <button
                                type="button"
                                onclick="copyLink()"
                                class="button_copy stroke"
                                id="copyURLbtn"
                                onmouseover="this.style.transform='scale(1.2)'"
                                onmouseout="this.style.transform='scale(1)'"
                                title="Click to Copy this link containing your BAZI URL, to clipboard!"
                                aria-label="Click to Copy this link containing your BAZI URL, to clipboard!"
                            >
                                COPY URL
                            </button>
                            <output
                                class="url-display"
                                id="urlDisplay"
                                aria-live="polite"
                            >
                                <span class="url-text" id="urlText"></span>
                            </output>
                        </div>
                    </form>
                </section>

                <section aria-labelledby="understanding-title" class="relative">
                    <h2
                        id="understanding-title"
                        class="section-title uppercase center"
                    >
                        More understanding
                    </h2>

                    <article
                        class="section-card astronomical-data"
                        id="astronomicalData"
                        aria-labelledby="astro-title"
                    >
                        <h3 id="astro-title">
                            Astronomical Data | 360° ÷ 24 = 15° per Solar Term
                        </h3>
                        <div class="data-grid">
                            <div class="data_card">
                                <div class="data_label">
                                    Sun's Ecliptic Longitude
                                </div>
                                <output class="data-value" id="sunLongitude"
                                    >--</output
                                >
                            </div>
                            <div class="data_card">
                                <div class="data_label">Julian Day Number</div>
                                <output class="data-value" id="julianDay"
                                    >--</output
                                >
                            </div>
                            <div class="data_card">
                                <div class="data_label">UTC Datetime</div>
                                <output class="data-value utc-time" id="utcTime"
                                    >--</output
                                >
                            </div>
                        </div>
                    </article>

                    <article
                        class="section-card solar-term-info"
                        id="solarTermInfo"
                        aria-labelledby="term-title"
                    >
                        <h3 id="term-title">
                            Geometric Position in Earth's Orbit
                        </h3>
                        <output id="termDetails"></output>
                        <div
                            class="term-progress"
                            role="progressbar"
                            aria-label="Solar term progress"
                        >
                            <div
                                class="term-progress-bar"
                                id="termProgress"
                            ></div>
                        </div>
                    </article>

                    <aside
                        class="section-card test-cases"
                        aria-labelledby="test-title"
                    >
                        <h3 id="test-title">
                            Geometric Test Points <br />
                            0°, 90°, 180°, 195°, 270°
                        </h3>
                        <button
                            type="button"
                            class="test-button"
                            onclick="testColdDew1967()"
                        >
                            Cold Dew 1967
                        </button>
                        <button
                            type="button"
                            class="test-button"
                            onclick="testSpringEquinox2024()"
                        >
                            Spring Equinox 2024
                        </button>
                        <button
                            type="button"
                            class="test-button"
                            onclick="testWinterSolstice2024()"
                        >
                            Winter Solstice 2024
                        </button>
                    </aside>
                </section>

                <section aria-labelledby="shortcuts-title" class="relative">
                    <h2
                        id="shortcuts-title"
                        class="section-title uppercase center"
                    >
                        Keyboard Shortcuts
                    </h2>
                    <article class="section-card shortcuts-section">
                        <div class="data-grid">
                            <div class="data_card">
                                <div class="data_label">Navigate Fields</div>
                                <div class="data-value">
                                    <kbd class="kbd">Enter</kbd>
                                </div>
                            </div>
                            <div class="data_card">
                                <div class="data_label">Kalculate</div>
                                <div class="data-value">
                                    <kbd class="kbd">Ctrl/⌘ + K</kbd>
                                </div>
                            </div>
                            <div class="data_card">
                                <div class="data_label">Reset to Now</div>
                                <div class="data-value">
                                    <kbd class="kbd">Ctrl/⌘ + R</kbd>
                                </div>
                            </div>
                            <div class="data_card">
                                <div class="data_label">Clear Session</div>
                                <div class="data-value">
                                    <kbd class="kbd">Ctrl/⌘ + ⇧ + C</kbd>
                                </div>
                            </div>
                            <div class="data_card">
                                <div class="data_label">Copy Link</div>
                                <div class="data-value">
                                    <kbd class="kbd">Ctrl/⌘ + L</kbd>
                                </div>
                            </div>
                        </div>
                    </article>
                </section>
            </main>

            <footer>
                <div class="container footwrap">
                    <section class="badges" aria-label="Project information">
                        <span class="validation-badge">
                            ✓ This Open Source webapp is made from first
                            principles. Zero Dependencies. No build step.
                        </span>
                        <span class="validation-badge">
                            ✓ Mathematics: Cold Dew 1967 Validated to ±0.001°
                        </span>
                        <span class="validation-badge">
                            ✓ Beautiful simplicity.
                        </span>
                        <span class="validation-badge">
                            ✓ Four Pillars of Destiny, "BaZi" Birth Time Eight
                            Characters, based on the Ganzhi calendar.
                        </span>
                        <span class="validation-badge">
                            ✓ Vibe Coded by Toybreaker w/help from Claude Opus
                            4.1
                        </span>
                        <span class="validation-badge">
                            ✓ Powered by:
                            <a
                                class="ext_link"
                                target="_blank"
                                href="https://junglestar.org"
                                >JUNGLESTAR</a
                            >
                        </span>
                    </section>

                    <aside class="share" aria-label="Share QR code">
                        <p class="center pad_bottom">SCAN & SHARE</p>
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            xml:space="preserve"
                            viewBox="0 0 1155 1155"
                        >
                            <path fill="lime" d="M0 0h1155v1155H0z" />
                            <path
                                d="M420 70h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm-315 35h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm105 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm-420 35h35v35h-35zm105 0h35v35h-35zm105 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm-350 35h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm-280 35h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm-385 35h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm-315 35h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm-420 35h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm175 0h35v35h-35zm70 0h35v35h-35zM70 350h35v35H70zm210 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zM70 385h35v35H70zm35 0h35v35h-35zm105 0h35v35h-35zm140 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm175 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zM70 420h35v35H70zm35 0h35v35h-35zm140 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm175 0h35v35h-35zm105 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm-805 35h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm105 0h35v35h-35zm105 0h35v35h-35zm-840 35h35v35h-35zm70 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm175 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm175 0h35v35h-35zm-875 35h35v35h-35zm35 0h35v35h-35zm140 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm175 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zM70 560h35v35H70zm35 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm140 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zM70 595h35v35H70zm70 0h35v35h-35zm70 0h35v35h-35zm105 0h35v35h-35zm70 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm280 0h35v35h-35zm70 0h35v35h-35zm-945 35h35v35h-35zm105 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm105 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm210 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zM70 665h35v35H70zm35 0h35v35h-35zm105 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm280 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zM70 700h35v35H70zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zM70 735h35v35H70zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm175 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm140 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zM70 770h35v35H70zm70 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm140 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm-700 35h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm140 0h35v35h-35zm35 0h35v35h-35zm-560 35h35v35h-35zm140 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm-525 35h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm140 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm140 0h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm-560 35h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm-595 35h35v35h-35zm105 0h35v35h-35zm105 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm140 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm-630 35h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm140 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm35 0h35v35h-35zm-630 35h35v35h-35zm105 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm210 0h35v35h-35zm140 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm-700 35h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm35 0h35v35h-35zm70 0h35v35h-35zm70 0h35v35h-35z"
                            />
                            <path
                                fill="none"
                                d="M106.8 106.8h171.4v171.4H106.8z"
                            />
                            <path
                                d="M278.3 70H70v245h245V70h-36.8zm0 208.3H106.7V106.7h171.6v171.6z"
                            />
                            <path
                                fill="none"
                                d="M876.8 106.8h171.5v171.4H876.8z"
                            />
                            <path
                                d="M1048.3 70H840v245h245V70h-36.8zm0 208.3H876.8V106.7h171.5v171.6z"
                            />
                            <path
                                fill="none"
                                d="M106.8 876.8h171.4v171.5H106.8z"
                            />
                            <path
                                d="M278.3 840H70v245h245V840h-36.8zm0 208.3H106.7V876.8h171.6v171.5zM140 140h105v105H140zm770 0h105v105H910z"
                            />
                            <path d="M140 910h105v105H140z" />
                        </svg>
                    </aside>
                </div>

                <aside class="donation" aria-label="Donation information">
                    Feeling Thankful? <br />Tip this project! <br />
                    <a
                        target="_blank"
                        class="ext_link"
                        href="https://ko-fi.com/junglo"
                    >
                        Buy Us a Coffee
                    </a>
                </aside>
            </footer>
        </div>

        <script>
            // ============================================================================
            // ASTRONOMICAL CORE ENGINE
            // ============================================================================

            function gregorianToJulianDay(
                year,
                month,
                day,
                hour = 0,
                minute = 0,
                second = 0,
            ) {
                if (month <= 2) {
                    year -= 1;
                    month += 12;
                }

                const A = Math.floor(year / 100);
                const B = 2 - A + Math.floor(A / 4);

                const JD =
                    Math.floor(365.25 * (year + 4716)) +
                    Math.floor(30.6001 * (month + 1)) +
                    day +
                    B -
                    1524.5 +
                    (hour + minute / 60 + second / 3600) / 24;

                return JD;
            }

            function sunLongitude(jd) {
                const T = (jd - 2451545.0) / 36525;
                const L0 = 280.46646 + 36000.76983 * T + 0.0003032 * T * T;
                const M = 357.52911 + 35999.05029 * T - 0.0001537 * T * T;
                const M_rad = (M * Math.PI) / 180;

                const C =
                    (1.914602 - 0.004817 * T - 0.000014 * T * T) *
                        Math.sin(M_rad) +
                    (0.019993 - 0.000101 * T) * Math.sin(2 * M_rad) +
                    0.000289 * Math.sin(3 * M_rad);

                let longitude = L0 + C;
                longitude -= 0.00569; // Aberration
                longitude = longitude % 360;
                if (longitude < 0) longitude += 360;

                return longitude;
            }

            // ============================================================================
            // SOLAR TERMS DATA
            // ============================================================================

            const SOLAR_TERMS = [
                {
                    index: 0,
                    longitude: 315,
                    name_cn: "立春",
                    name_en: "Start of Spring",
                    name_pinyin: "Lìchūn",
                },
                {
                    index: 1,
                    longitude: 330,
                    name_cn: "雨水",
                    name_en: "Rain Water",
                    name_pinyin: "Yǔshuǐ",
                },
                {
                    index: 2,
                    longitude: 345,
                    name_cn: "惊蛰",
                    name_en: "Awakening of Insects",
                    name_pinyin: "Jīngzhé",
                },
                {
                    index: 3,
                    longitude: 0,
                    name_cn: "春分",
                    name_en: "Spring Equinox",
                    name_pinyin: "Chūnfēn",
                },
                {
                    index: 4,
                    longitude: 15,
                    name_cn: "清明",
                    name_en: "Clear and Bright",
                    name_pinyin: "Qīngmíng",
                },
                {
                    index: 5,
                    longitude: 30,
                    name_cn: "谷雨",
                    name_en: "Grain Rain",
                    name_pinyin: "Gǔyǔ",
                },
                {
                    index: 6,
                    longitude: 45,
                    name_cn: "立夏",
                    name_en: "Start of Summer",
                    name_pinyin: "Lìxià",
                },
                {
                    index: 7,
                    longitude: 60,
                    name_cn: "小满",
                    name_en: "Grain Full",
                    name_pinyin: "Xiǎomǎn",
                },
                {
                    index: 8,
                    longitude: 75,
                    name_cn: "芒种",
                    name_en: "Grain in Ear",
                    name_pinyin: "Mángzhòng",
                },
                {
                    index: 9,
                    longitude: 90,
                    name_cn: "夏至",
                    name_en: "Summer Solstice",
                    name_pinyin: "Xiàzhì",
                },
                {
                    index: 10,
                    longitude: 105,
                    name_cn: "小暑",
                    name_en: "Minor Heat",
                    name_pinyin: "Xiǎoshǔ",
                },
                {
                    index: 11,
                    longitude: 120,
                    name_cn: "大暑",
                    name_en: "Major Heat",
                    name_pinyin: "Dàshǔ",
                },
                {
                    index: 12,
                    longitude: 135,
                    name_cn: "立秋",
                    name_en: "Start of Autumn",
                    name_pinyin: "Lìqiū",
                },
                {
                    index: 13,
                    longitude: 150,
                    name_cn: "处暑",
                    name_en: "End of Heat",
                    name_pinyin: "Chǔshǔ",
                },
                {
                    index: 14,
                    longitude: 165,
                    name_cn: "白露",
                    name_en: "White Dew",
                    name_pinyin: "Báilù",
                },
                {
                    index: 15,
                    longitude: 180,
                    name_cn: "秋分",
                    name_en: "Autumn Equinox",
                    name_pinyin: "Qiūfēn",
                },
                {
                    index: 16,
                    longitude: 195,
                    name_cn: "寒露",
                    name_en: "Cold Dew",
                    name_pinyin: "Hánlù",
                },
                {
                    index: 17,
                    longitude: 210,
                    name_cn: "霜降",
                    name_en: "Frost Descent",
                    name_pinyin: "Shuāngjiàng",
                },
                {
                    index: 18,
                    longitude: 225,
                    name_cn: "立冬",
                    name_en: "Start of Winter",
                    name_pinyin: "Lìdōng",
                },
                {
                    index: 19,
                    longitude: 240,
                    name_cn: "小雪",
                    name_en: "Minor Snow",
                    name_pinyin: "Xiǎoxuě",
                },
                {
                    index: 20,
                    longitude: 255,
                    name_cn: "大雪",
                    name_en: "Major Snow",
                    name_pinyin: "Dàxuě",
                },
                {
                    index: 21,
                    longitude: 270,
                    name_cn: "冬至",
                    name_en: "Winter Solstice",
                    name_pinyin: "Dōngzhì",
                },
                {
                    index: 22,
                    longitude: 285,
                    name_cn: "小寒",
                    name_en: "Minor Cold",
                    name_pinyin: "Xiǎohán",
                },
                {
                    index: 23,
                    longitude: 300,
                    name_cn: "大寒",
                    name_en: "Major Cold",
                    name_pinyin: "Dàhán",
                },
            ];

            // ============================================================================
            // SEXAGENARY CYCLE DATA
            // ============================================================================

            const HEAVENLY_STEMS = {
                names: [
                    "甲",
                    "乙",
                    "丙",
                    "丁",
                    "戊",
                    "己",
                    "庚",
                    "辛",
                    "壬",
                    "癸",
                ],
                pinyin: [
                    "Jiǎ",
                    "Yǐ",
                    "Bǐng",
                    "Dīng",
                    "Wù",
                    "Jǐ",
                    "Gēng",
                    "Xīn",
                    "Rén",
                    "Guǐ",
                ],
                elements: [
                    "Wood",
                    "Wood",
                    "Fire",
                    "Fire",
                    "Earth",
                    "Earth",
                    "Metal",
                    "Metal",
                    "Water",
                    "Water",
                ],
                yin_yang: [
                    "Yang",
                    "Yin",
                    "Yang",
                    "Yin",
                    "Yang",
                    "Yin",
                    "Yang",
                    "Yin",
                    "Yang",
                    "Yin",
                ],
            };

            const EARTHLY_BRANCHES = {
                names: [
                    "子",
                    "丑",
                    "寅",
                    "卯",
                    "辰",
                    "巳",
                    "午",
                    "未",
                    "申",
                    "酉",
                    "戌",
                    "亥",
                ],
                pinyin: [
                    "Zǐ",
                    "Chǒu",
                    "Yín",
                    "Mǎo",
                    "Chén",
                    "Sì",
                    "Wǔ",
                    "Wèi",
                    "Shēn",
                    "Yǒu",
                    "Xū",
                    "Hài",
                ],
                animals: [
                    "Rat",
                    "Ox",
                    "Tiger",
                    "Rabbit",
                    "Dragon",
                    "Snake",
                    "Horse",
                    "Goat",
                    "Monkey",
                    "Rooster",
                    "Dog",
                    "Pig",
                ],
                emojis: [
                    "🐀",
                    "🐂",
                    "🐅",
                    "🐇",
                    "🐉",
                    "🐍",
                    "🐎",
                    "🐐",
                    "🐒",
                    "🐓",
                    "🐕",
                    "🐖",
                ],
            };

            // ============================================================================
            // URL HANDLING
            // ============================================================================

            function updateURL() {
                const params = new URLSearchParams();
                params.set("y", document.getElementById("year").value);
                params.set("m", document.getElementById("month").value);
                params.set("d", document.getElementById("day").value);
                params.set("h", document.getElementById("hour").value);
                params.set("min", document.getElementById("minute").value);
                params.set("tz", document.getElementById("timezone").value);

                // Create shareable URL
                const shareableURL =
                    "https://bazi.junglestar.org?" + params.toString();

                // Show URL display with copy icon
                document.getElementById("urlDisplay").style.display = "flex";
                document.getElementById("urlText").textContent = shareableURL;

                // Store for copying
                window.shareableURL = shareableURL;
            }

            function loadFromURL() {
                const params = new URLSearchParams(window.location.search);

                if (params.has("y")) {
                    document.getElementById("year").value = params.get("y");
                    document.getElementById("month").value =
                        params.get("m") || "1";
                    document.getElementById("day").value =
                        params.get("d") || "1";
                    document.getElementById("hour").value =
                        params.get("h") || "0";
                    document.getElementById("minute").value =
                        params.get("min") || "0";
                    document.getElementById("timezone").value =
                        params.get("tz") || "0";
                    calculateBaZi();
                    return true;
                }
                return false;
            }

            function copyLink() {
                // Use the stored shareable URL
                const url =
                    window.shareableURL || "https://bazi.junglestar.org";

                // Try modern clipboard API first
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard
                        .writeText(url)
                        .then(() => {
                            const icon = document.getElementById("copyURLbtn");
                            const originalIcon = icon.innerHTML;
                            icon.innerHTML = "🖤 COPIED!";
                            icon.style.color = "black";

                            setTimeout(() => {
                                icon.innerHTML = originalIcon;
                                icon.style.color = "black";
                            }, 2000);
                        })
                        .catch((err) => {
                            // Fallback to older method
                            fallbackCopyTextToClipboard(url);
                        });
                } else {
                    // Fallback for older browsers
                    fallbackCopyTextToClipboard(url);
                }
            }

            function fallbackCopyTextToClipboard(text) {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.top = "0";
                textArea.style.left = "0";
                textArea.style.width = "2em";
                textArea.style.height = "2em";
                textArea.style.padding = "0";
                textArea.style.border = "none";
                textArea.style.outline = "none";
                textArea.style.boxShadow = "none";
                textArea.style.background = "transparent";

                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();

                try {
                    document.execCommand("copy");
                    const icon = document.getElementById("copyURLbtn");
                    const originalIcon = icon.innerHTML;
                    icon.innerHTML = "✅";
                    icon.style.color = "oklch(0.69 0.20 142)";

                    setTimeout(() => {
                        icon.innerHTML = originalIcon;
                        icon.style.color = "oklch(0.87 0.28 142)";
                    }, 2000);
                } catch (err) {
                    console.error("Failed to copy:", err);
                    alert("Press Ctrl+C/Cmd+C to copy: " + text);
                }

                document.body.removeChild(textArea);
            }

            // ============================================================================
            // BA ZI CALCULATION
            // ============================================================================

            function getSolarTermIndex(longitude) {
                // Each solar term covers 15° starting from its longitude
                // We need to find which term's range contains our longitude
                const normalized = (longitude + 360) % 360;

                // Solar terms are arranged with Spring Equinox at 0°
                // Start of Spring at 315° is actually term 0
                // The sequence goes: 315, 330, 345, 0, 15, 30...

                for (let i = 0; i < SOLAR_TERMS.length; i++) {
                    const termStart = SOLAR_TERMS[i].longitude;
                    const termEnd = (termStart + 15) % 360;

                    // Handle the wrap-around case (e.g., 345° to 0°)
                    if (termStart > termEnd) {
                        // Range wraps around 360°
                        if (normalized >= termStart || normalized < termEnd) {
                            return i;
                        }
                    } else {
                        // Normal range
                        if (normalized >= termStart && normalized < termEnd) {
                            return i;
                        }
                    }
                }

                return 0; // Default (shouldn't reach here)
            }

            function calculateYearPillar(year, solarTermIndex) {
                // Year changes at Start of Spring (立春), not January 1
                // Start of Spring is solar term 0
                // If we're before Start of Spring, use previous year
                // Simplified: using calendar year for now

                const stemIndex = (year - 4) % 10;
                const branchIndex = (year - 4) % 12;

                return {
                    stem: (stemIndex + 10) % 10, // Ensure positive
                    branch: (branchIndex + 12) % 12, // Ensure positive
                };
            }

            function calculateMonthPillar(year, solarTermIndex) {
                // Month pillar based on solar term pairs
                // Each pair of solar terms corresponds to one month
                // Terms 0-1 (立春/雨水) = Tiger month (branch 2)
                // Terms 2-3 (惊蛰/春分) = Rabbit month (branch 3), etc.

                const monthBranch = (Math.floor(solarTermIndex / 2) + 2) % 12;

                // Month stem calculation based on year stem
                const yearStem = (((year - 4) % 10) + 10) % 10; // Ensure positive
                // Formula: monthStem = (yearStem * 2 + monthBranch) % 10
                const monthStem = (yearStem * 2 + monthBranch) % 10;

                return {
                    stem: (monthStem + 10) % 10, // Ensure positive
                    branch: (monthBranch + 12) % 12, // Ensure positive
                };
            }

            function calculateDayPillar(jd) {
                // Day pillar cycles every 60 days
                // Known reference: January 1, 1900 was 甲戌 day (stem 0, branch 10)
                const referenceJD = gregorianToJulianDay(1900, 1, 1, 0, 0, 0); // 2415020.5
                const daysSince = Math.floor(jd - referenceJD);

                // Calculate from base: 甲戌 (stem 0, branch 10)
                const stemIndex = (0 + daysSince) % 10;
                const branchIndex = (10 + daysSince) % 12;

                return {
                    stem: (stemIndex + 10) % 10, // Normalize to positive
                    branch: (branchIndex + 12) % 12, // Normalize to positive
                };
            }

            function calculateHourPillar(hour, dayStem) {
                // Double-hour system (时辰)
                // 23:00-01:00 = 子时 (branch 0), 01:00-03:00 = 丑时 (branch 1), etc.
                const hourBranch = Math.floor((hour + 1) / 2) % 12;

                // Hour stem depends on day stem
                // Formula from traditional Ba Zi
                const hourStem = (dayStem * 2 + hourBranch) % 10;

                return {
                    stem: (hourStem + 10) % 10, // Ensure positive
                    branch: (hourBranch + 12) % 12, // Ensure positive
                };
            }

            function calculateBaZi() {
                // Get input values
                const year = parseInt(document.getElementById("year").value);
                const month = parseInt(document.getElementById("month").value);
                const day = parseInt(document.getElementById("day").value);
                const hour = parseInt(document.getElementById("hour").value);
                const minute = parseInt(
                    document.getElementById("minute").value,
                );
                const timezone = parseFloat(
                    document.getElementById("timezone").value,
                );

                // Save to session storage for persistence
                saveToSession();

                // Debug logging for October 1967
                const isDebugDate = year === 1967 && month === 10;

                // Create a date object and adjust for timezone
                const localDate = new Date(
                    year,
                    month - 1,
                    day,
                    hour,
                    minute,
                    0,
                );
                const utcDate = new Date(
                    localDate.getTime() - timezone * 60 * 60 * 1000,
                );

                // Get UTC components
                const utcYear = utcDate.getUTCFullYear();
                const utcMonth = utcDate.getUTCMonth() + 1;
                const utcDay = utcDate.getUTCDate();
                const utcHour = utcDate.getUTCHours();
                const utcMinute = utcDate.getUTCMinutes();

                // Calculate Julian Day
                const jd = gregorianToJulianDay(
                    utcYear,
                    utcMonth,
                    utcDay,
                    utcHour,
                    utcMinute,
                    0,
                );

                // Calculate sun position
                const longitude = sunLongitude(jd);
                const solarTermIndex = getSolarTermIndex(longitude);
                const currentTerm = SOLAR_TERMS[solarTermIndex];
                const nextTermIndex = (solarTermIndex + 1) % 24;
                const nextTerm = SOLAR_TERMS[nextTermIndex];

                if (isDebugDate) {
                    console.log("=== DEBUG October 1967 ===");
                    console.log(
                        `Input: ${year}-${month}-${day} ${hour}:${minute} TZ:${timezone}`,
                    );
                    console.log(
                        `UTC: ${utcYear}-${utcMonth}-${utcDay} ${utcHour}:${utcMinute}`,
                    );
                    console.log(`JD: ${jd}`);
                    console.log(`Sun Longitude: ${longitude}°`);
                    console.log(`Solar Term Index: ${solarTermIndex}`);
                    console.log(
                        `Solar Term: ${currentTerm.name_en} (${currentTerm.name_cn})`,
                    );
                    console.log(`Term starts at: ${currentTerm.longitude}°`);
                }

                // Calculate progress through solar term
                const progress =
                    ((longitude - currentTerm.longitude + 360) % 360) / 15;

                // Calculate four pillars
                const yearPillar = calculateYearPillar(year, solarTermIndex);
                const monthPillar = calculateMonthPillar(year, solarTermIndex);
                const dayPillar = calculateDayPillar(jd);
                const hourPillar = calculateHourPillar(hour, dayPillar.stem);

                if (isDebugDate) {
                    const branches = [
                        "子 Rat",
                        "丑 Ox",
                        "寅 Tiger",
                        "卯 Rabbit",
                        "辰 Dragon",
                        "巳 Snake",
                        "午 Horse",
                        "未 Goat",
                        "申 Monkey",
                        "酉 Rooster",
                        "戌 Dog",
                        "亥 Pig",
                    ];
                    console.log(
                        `Month Pillar Branch: ${monthPillar.branch} = ${branches[monthPillar.branch]}`,
                    );
                    console.log("======================");
                }

                // Display calculated date info
                const monthNames = [
                    "January",
                    "February",
                    "March",
                    "April",
                    "May",
                    "June",
                    "July",
                    "August",
                    "September",
                    "October",
                    "November",
                    "December",
                ];
                const dayNames = [
                    "Sunday",
                    "Monday",
                    "Tuesday",
                    "Wednesday",
                    "Thursday",
                    "Friday",
                    "Saturday",
                ];

                const localDateDisplay = new Date(
                    year,
                    month - 1,
                    day,
                    hour,
                    minute,
                );
                const dayOfWeek = dayNames[localDateDisplay.getDay()];
                const monthName = monthNames[month - 1];

                // Get timezone name from select
                const timezoneSelect = document.getElementById("timezone");
                const timezoneName =
                    timezoneSelect.options[timezoneSelect.selectedIndex].text;

                document.getElementById("calculatedDateInfo").style.display =
                    "block";
                document.getElementById("dateDisplay").innerHTML =
                    `${dayOfWeek}, ${monthName} ${day}, ${year} at ${hour.toString().padStart(2, "0")}:${minute.toString().padStart(2, "0")} (${timezoneName})`;

                // Display astronomical data
                document.getElementById("astronomicalData").style.display =
                    "block";
                document.getElementById("sunLongitude").textContent =
                    longitude.toFixed(3) + "°";
                document.getElementById("julianDay").textContent =
                    jd.toFixed(3);
                document.getElementById("utcTime").textContent =
                    utcDate.toISOString().replace("T", " ").slice(0, -5) +
                    " UTC";

                // Display solar term info
                document.getElementById("solarTermInfo").style.display =
                    "block";
                document.getElementById("termDetails").innerHTML = `
                    <p>Current Term: <strong>${currentTerm.name_cn} ${currentTerm.name_en}</strong> (${currentTerm.name_pinyin})</p>
                    <p>Solar Term Index: <strong>${solarTermIndex}</strong> (Terms ${solarTermIndex}-${solarTermIndex % 2 === 0 ? solarTermIndex + 1 : solarTermIndex} = Month Branch ${(Math.floor(solarTermIndex / 2) + 2) % 12})</p>
                    <p>Next Term: ${nextTerm.name_cn} ${nextTerm.name_en} in ${((1 - progress) * 15).toFixed(1)}°</p>
                    <p>Progress: ${(progress * 100).toFixed(1)}% through current term</p>
                `;
                document.getElementById("termProgress").style.width =
                    `${progress * 100}%`;

                // Display four pillars
                const pillarsHTML =
                    generatePillarHTML("Year", yearPillar) +
                    generatePillarHTML("Month", monthPillar) +
                    generatePillarHTML("Day", dayPillar) +
                    generatePillarHTML("Hour", hourPillar);

                document.getElementById("pillarsContainer").innerHTML =
                    pillarsHTML;

                // Update URL with current parameters
                updateURL();
            }

            function generatePillarHTML(title, pillar) {
                const stem = HEAVENLY_STEMS.names[pillar.stem];
                const branch = EARTHLY_BRANCHES.names[pillar.branch];
                const stemPinyin = HEAVENLY_STEMS.pinyin[pillar.stem];
                const branchPinyin = EARTHLY_BRANCHES.pinyin[pillar.branch];
                const element = HEAVENLY_STEMS.elements[pillar.stem];
                const animal = EARTHLY_BRANCHES.animals[pillar.branch];
                const emoji = EARTHLY_BRANCHES.emojis[pillar.branch];
                const yinYang = HEAVENLY_STEMS.yin_yang[pillar.stem];

                const elementClass = `element-${element.toLowerCase()}`;
                const emojiClass = `animal-emoji-${element.toLowerCase()}`;

                return `
                    <article class="pillar" aria-label="${title} Pillar">
                        <h4 class="pillar-title vert uppercase">${title}</h4>
                        <div class="stem-branch">
                            <div>
                                <div class="chinese-char" lang="zh">${stem}</div>
                                <div class="pinyin">${stemPinyin}</div>
                            </div>
                            <div>
                                <div class="chinese-char" lang="zh">${branch}</div>
                                <div class="pinyin">${branchPinyin}</div>
                            </div>
                        </div>
                        <div class="animal-emoji ${emojiClass}" role="img" aria-label="${animal} emoji">${emoji}</div>
                        <div class="animal-info">${animal}</div>
                        <div class="animal-yy ${yinYang}">${yinYang}</div>
                        <span class="element ${elementClass}">${element}</span>
                    </article>
                `;
            }

            // ============================================================================
            // TEST CASES
            // ============================================================================

            function testColdDew1967() {
                document.getElementById("year").value = "1967";
                document.getElementById("month").value = "10";
                document.getElementById("day").value = "9";
                document.getElementById("hour").value = "0";
                document.getElementById("minute").value = "0";
                document.getElementById("timezone").value = "0";
                calculateBaZi();
            }

            function testSpringEquinox2024() {
                document.getElementById("year").value = "2024";
                document.getElementById("month").value = "3";
                document.getElementById("day").value = "20";
                document.getElementById("hour").value = "3";
                document.getElementById("minute").value = "6";
                document.getElementById("timezone").value = "0";
                calculateBaZi();
            }

            function testWinterSolstice2024() {
                document.getElementById("year").value = "2024";
                document.getElementById("month").value = "12";
                document.getElementById("day").value = "21";
                document.getElementById("hour").value = "9";
                document.getElementById("minute").value = "20";
                document.getElementById("timezone").value = "0";
                calculateBaZi();
            }

            function testCurrentTime() {
                const now = new Date();
                document.getElementById("year").value = now.getFullYear();
                document.getElementById("month").value = now.getMonth() + 1;
                document.getElementById("day").value = now.getDate();
                document.getElementById("hour").value = now.getHours();
                document.getElementById("minute").value = now.getMinutes();

                // Clear session storage when resetting to current time
                clearSession();

                // Get timezone offset in hours (getTimezoneOffset returns minutes, negative for east of UTC)
                const offsetMinutes = -now.getTimezoneOffset();
                const offsetHours = offsetMinutes / 60;

                // Try to match the offset to our select options
                const timezoneSelect = document.getElementById("timezone");
                let optionFound = false;

                for (let i = 0; i < timezoneSelect.options.length; i++) {
                    const optionValue = parseFloat(
                        timezoneSelect.options[i].value,
                    );
                    // Allow small tolerance for matching (0.1 hours = 6 minutes)
                    if (Math.abs(optionValue - offsetHours) < 0.1) {
                        timezoneSelect.selectedIndex = i;
                        optionFound = true;
                        break;
                    }
                }

                // If no matching option, default to UTC
                if (!optionFound) {
                    timezoneSelect.value = "0";
                    console.log(
                        `Your timezone offset (${offsetHours} hours) not in list, defaulting to UTC`,
                    );
                }

                calculateBaZi();
            }

            // ============================================================================
            // SESSION PERSISTENCE
            // ============================================================================

            function saveToSession() {
                const sessionData = {
                    year: document.getElementById("year").value,
                    month: document.getElementById("month").value,
                    day: document.getElementById("day").value,
                    hour: document.getElementById("hour").value,
                    minute: document.getElementById("minute").value,
                    timezone: document.getElementById("timezone").value,
                    timestamp: Date.now(),
                };
                sessionStorage.setItem(
                    "baziCalculatorData",
                    JSON.stringify(sessionData),
                );
            }

            function loadFromSession() {
                const savedData = sessionStorage.getItem("baziCalculatorData");
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        document.getElementById("year").value = data.year;
                        document.getElementById("month").value = data.month;
                        document.getElementById("day").value = data.day;
                        document.getElementById("hour").value = data.hour;
                        document.getElementById("minute").value = data.minute;
                        document.getElementById("timezone").value =
                            data.timezone;
                        return true;
                    } catch (e) {
                        console.error("Error loading session data:", e);
                        return false;
                    }
                }
                return false;
            }

            function clearSession() {
                sessionStorage.removeItem("baziCalculatorData");
            }

            function clearSessionAndReload() {
                clearSession();
                testCurrentTime();
                // Show feedback
                const msg = document.createElement("div");
                msg.textContent = "✓ Session cleared";
                msg.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: oklch(0.65 0.15 142 / 0.9);
                    color: white;
                    padding: 10px 20px;
                    border-radius: 5px;
                    font-size: 0.9rem;
                    z-index: 1000;
                `;
                document.body.appendChild(msg);
                setTimeout(() => document.body.removeChild(msg), 2000);
            }

            // Load with URL parameters, session storage, or current time on startup
            window.onload = () => {
                // Priority order:
                // 1. URL parameters (for shared links)
                // 2. Session storage (for page refreshes)
                // 3. Current time (for new visits)

                if (!loadFromURL()) {
                    // No URL parameters, try session storage
                    if (loadFromSession()) {
                        // Successfully loaded from session, calculate with saved data
                        calculateBaZi();
                        // Show subtle indicator that session was restored
                        showSessionRestoredIndicator();
                    } else {
                        // No session data, load current time
                        testCurrentTime();
                    }
                }
            };

            function showSessionRestoredIndicator() {
                // Create a temporary indicator
                const indicator = document.createElement("div");
                indicator.textContent = "✓ Previous session restored";
                indicator.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: oklch(0.87 0.28 142 / 0.9);
                    color: oklch(0.15 0.02 142);
                    padding: 10px 20px;
                    border-radius: 5px;
                    font-size: 0.9rem;
                    z-index: 1000;
                    animation: slideIn 0.3s ease-out;
                `;

                // Add animation
                const style = document.createElement("style");
                style.textContent = `
                    @keyframes slideIn {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(indicator);

                // Remove after 3 seconds
                setTimeout(() => {
                    indicator.style.animation = "slideIn 0.3s ease-out reverse";
                    setTimeout(() => {
                        document.body.removeChild(indicator);
                        document.head.removeChild(style);
                    }, 300);
                }, 3000);
            }
        </script>

        <!-- KYB SHORTCUTS -->
        <script>
            // KYB SHORTCUTS - Updated version
            window.addEventListener("keydown", function (e) {
                // ENTER: Cycle focus through fields and buttons
                if (e.key === "Enter") {
                    e.preventDefault();

                    const focusElements = [
                        "year",
                        "month",
                        "day",
                        "hour",
                        "minute",
                        "timezone",
                        "calculateBtn",
                        "resetBtn",
                        "clearBtn",
                        "copyURLbtn", // Note: fixed the ID here
                    ];

                    const currentId = document.activeElement.id;
                    const currentIndex = focusElements.indexOf(currentId);

                    // Get next element (loop back to start)
                    const nextIndex = (currentIndex + 1) % focusElements.length;
                    const nextElement = document.getElementById(
                        focusElements[nextIndex],
                    );

                    if (nextElement) {
                        nextElement.focus();
                    } else {
                        // If no element focused, start with year
                        document.getElementById("year").focus();
                    }
                }

                // Ctrl/Cmd + K: Calculate (K for kalculate)
                else if (
                    (e.ctrlKey || e.metaKey) &&
                    e.key.toLowerCase() === "k"
                ) {
                    e.preventDefault();
                    calculateBaZi();
                }

                // Ctrl/Cmd + R: Reset to Now
                else if (
                    (e.ctrlKey || e.metaKey) &&
                    e.key.toLowerCase() === "r"
                ) {
                    e.preventDefault();
                    testCurrentTime();
                }

                // Ctrl/Cmd + Shift + C: Clear Session
                else if (
                    (e.ctrlKey || e.metaKey) &&
                    e.shiftKey &&
                    e.key.toLowerCase() === "c"
                ) {
                    e.preventDefault();
                    clearSessionAndReload();
                }

                // Ctrl/Cmd + L: Copy Link
                else if (
                    (e.ctrlKey || e.metaKey) &&
                    e.key.toLowerCase() === "l"
                ) {
                    e.preventDefault();
                    copyLink();
                }
            });
        </script>

        <!-- Google tag (gtag.js) -->
        <script
            async
            src="https://www.googletagmanager.com/gtag/js?id=G-VWQ3CKK40T"
        ></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag("js", new Date());

            gtag("config", "G-VWQ3CKK40T");
        </script>
    </body>
</html>
